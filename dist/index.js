#!/usr/bin/env node
'use strict';

var _sourceMapSupport = require('source-map-support');

(0, _sourceMapSupport.install)();

var PouchService = require('./pouchService');
var couchServer = 'http://couchdb.fairhursts.net:5984'; // TODO: move into config
var db = 'visits';

var pouch = new PouchService(db, couchServer);

// Ignore deleted records
var processChange = function processChange(change) {
    if (change.doc && !change.doc._deleted) {
        testForCompleted(change.doc);
    }
};

// Filter completed records
var testForCompleted = function testForCompleted(doc) {
    if (doc.status && doc.status === 'completed') {
        moveDoc(doc);
    }
};

// Move record into completed queue
var moveDoc = function moveDoc(doc) {
    console.log('Moving ' + doc._id + ' to completed queue');
};

// Subcribe to any changes in the local database
pouch.subscribe(processChange);

// Calling Sync() will grab a full dataset from the server
// and create an open event listener that keeps this app alive
pouch.sync();

console.log('MFA Processing Service Running...');
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9pbmRleC5qcyJdLCJuYW1lcyI6WyJQb3VjaFNlcnZpY2UiLCJyZXF1aXJlIiwiY291Y2hTZXJ2ZXIiLCJkYiIsInBvdWNoIiwicHJvY2Vzc0NoYW5nZSIsImNoYW5nZSIsImRvYyIsIl9kZWxldGVkIiwidGVzdEZvckNvbXBsZXRlZCIsInN0YXR1cyIsIm1vdmVEb2MiLCJjb25zb2xlIiwibG9nIiwiX2lkIiwic3Vic2NyaWJlIiwic3luYyJdLCJtYXBwaW5ncyI6Ijs7QUFDQTs7QUFDQTs7QUFFQSxJQUFNQSxlQUFlQyxRQUFRLGdCQUFSLENBQXJCO0FBQ0EsSUFBTUMsY0FBYyxvQ0FBcEIsQyxDQUErRDtBQUMvRCxJQUFNQyxLQUFLLFFBQVg7O0FBRUEsSUFBTUMsUUFBUSxJQUFJSixZQUFKLENBQWlCRyxFQUFqQixFQUFxQkQsV0FBckIsQ0FBZDs7QUFFQTtBQUNBLElBQU1HLGdCQUFnQixTQUFoQkEsYUFBZ0IsQ0FBQ0MsTUFBRCxFQUFZO0FBQzlCLFFBQUlBLE9BQU9DLEdBQVAsSUFBYyxDQUFDRCxPQUFPQyxHQUFQLENBQVdDLFFBQTlCLEVBQXdDO0FBQUVDLHlCQUFpQkgsT0FBT0MsR0FBeEI7QUFBOEI7QUFDM0UsQ0FGRDs7QUFJQTtBQUNBLElBQU1FLG1CQUFtQixTQUFuQkEsZ0JBQW1CLENBQUNGLEdBQUQsRUFBUztBQUM5QixRQUFJQSxJQUFJRyxNQUFKLElBQWVILElBQUlHLE1BQUosS0FBZSxXQUFsQyxFQUFnRDtBQUFFQyxnQkFBUUosR0FBUjtBQUFjO0FBQ25FLENBRkQ7O0FBSUE7QUFDQSxJQUFNSSxVQUFVLFNBQVZBLE9BQVUsQ0FBQ0osR0FBRCxFQUFTO0FBQ3JCSyxZQUFRQyxHQUFSLENBQVksWUFBWU4sSUFBSU8sR0FBaEIsR0FBc0IscUJBQWxDO0FBQ0gsQ0FGRDs7QUFJQTtBQUNBVixNQUFNVyxTQUFOLENBQWdCVixhQUFoQjs7QUFFQTtBQUNBO0FBQ0FELE1BQU1ZLElBQU47O0FBRUFKLFFBQVFDLEdBQVIsQ0FBWSxtQ0FBWiIsImZpbGUiOiJpbmRleC5qcyIsInNvdXJjZXNDb250ZW50IjpbIlxuaW1wb3J0IHsgaW5zdGFsbCB9IGZyb20gJ3NvdXJjZS1tYXAtc3VwcG9ydCc7XG5pbnN0YWxsKCk7XG5cbmNvbnN0IFBvdWNoU2VydmljZSA9IHJlcXVpcmUoJy4vcG91Y2hTZXJ2aWNlJylcbmNvbnN0IGNvdWNoU2VydmVyID0gJ2h0dHA6Ly9jb3VjaGRiLmZhaXJodXJzdHMubmV0OjU5ODQnICAgICAgIC8vIFRPRE86IG1vdmUgaW50byBjb25maWdcbmNvbnN0IGRiID0gJ3Zpc2l0cydcblxuY29uc3QgcG91Y2ggPSBuZXcgUG91Y2hTZXJ2aWNlKGRiLCBjb3VjaFNlcnZlcilcblxuLy8gSWdub3JlIGRlbGV0ZWQgcmVjb3Jkc1xuY29uc3QgcHJvY2Vzc0NoYW5nZSA9IChjaGFuZ2UpID0+IHtcbiAgICBpZiAoY2hhbmdlLmRvYyAmJiAhY2hhbmdlLmRvYy5fZGVsZXRlZCkgeyB0ZXN0Rm9yQ29tcGxldGVkKGNoYW5nZS5kb2MpIH1cbn1cblxuLy8gRmlsdGVyIGNvbXBsZXRlZCByZWNvcmRzXG5jb25zdCB0ZXN0Rm9yQ29tcGxldGVkID0gKGRvYykgPT4ge1xuICAgIGlmIChkb2Muc3RhdHVzICYmIChkb2Muc3RhdHVzID09PSAnY29tcGxldGVkJykpIHsgbW92ZURvYyhkb2MpIH1cbn1cblxuLy8gTW92ZSByZWNvcmQgaW50byBjb21wbGV0ZWQgcXVldWVcbmNvbnN0IG1vdmVEb2MgPSAoZG9jKSA9PiB7XG4gICAgY29uc29sZS5sb2coJ01vdmluZyAnICsgZG9jLl9pZCArICcgdG8gY29tcGxldGVkIHF1ZXVlJylcbn1cblxuLy8gU3ViY3JpYmUgdG8gYW55IGNoYW5nZXMgaW4gdGhlIGxvY2FsIGRhdGFiYXNlXG5wb3VjaC5zdWJzY3JpYmUocHJvY2Vzc0NoYW5nZSlcblxuLy8gQ2FsbGluZyBTeW5jKCkgd2lsbCBncmFiIGEgZnVsbCBkYXRhc2V0IGZyb20gdGhlIHNlcnZlclxuLy8gYW5kIGNyZWF0ZSBhbiBvcGVuIGV2ZW50IGxpc3RlbmVyIHRoYXQga2VlcHMgdGhpcyBhcHAgYWxpdmVcbnBvdWNoLnN5bmMoKVxuXG5jb25zb2xlLmxvZygnTUZBIFByb2Nlc3NpbmcgU2VydmljZSBSdW5uaW5nLi4uJykiXX0=